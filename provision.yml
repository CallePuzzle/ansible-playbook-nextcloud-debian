---
- name: Callepuzzle OPNSense
  hosts: all
  become: true
  become_method: su

  collections:
    - nginxinc.nginx_core
  pre_tasks:
    - name: Install python-setuptools
      apt:
        name: python-setuptools
      tags:
        - nextcloud

  roles:
    - { role: nextcloud, tags: [ 'nextcloud' ] }
    - { role: photoprism, tags: [ 'photoprism' ], vars: {
          photoprism_admin_password: "{{ photoprism_admin_password_viajes }}",
          photoprism_site_url: "https://fotos.viajes.callepuzzle.com",
          photoprism_database_name: "photoprismviajes",
          photoprism_database_user: "photoprismviajes",
          photoprism_database_password: "{{ photoprism_database_password_viajes }}",
          photoprism_site_title: "Fotos viajes",
          photoprism_site_caption: "Fotos viajes",
          photoprism_site_description: "",
          photoprism_site_author: "",
          photoprism_originals: /srv/docker/photoprism_viajes/originals,
          photoprism_storage: /srv/docker/photoprism_viajes/storage,
      }}
    - { role: nginx, tags: [ 'nginx' ] }
    - { role: nginx_config, tags: [ 'nginx' ] }

  tasks:
    - name: Copy dhparam
      copy:
        src: templates/dhparam
        dest: /etc/nginx/dhparam
      tags:
        - nginx
